<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Poker Face</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        let socket = io();

        // Function to initialize the game
        function startGame() {
            fetch('/start-game', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    updateGameState(data);
                });
        }

        /* TODO: update this to reference actual elements or switch to Jinja */
        // Function to update the UI based on the game state
        function updateGameState(gameState) {
            document.getElementById('gameBoard').innerHTML = JSON.stringify(gameState.board);
            document.getElementById('currentTurn').innerHTML = `Current Turn: ${gameState.current_turn}`;
        }

        // Listen for game state updates from the server
        socket.on('update_game_state', function(gameState) {
            updateGameState(gameState);
        });

        // Function to send user move to the server
        function sendUserMove(move) {
           socket.emit('user_move', { move: move });
        }

        // Initialize game when the page loads
        window.onload = function() {
           startGame();
        }
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bangers&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="menu">
        <a href="/">Home</a> | <a href="/game">Game</a> | <a href="/settings">Settings</a> | <a href="/about">About</a>
    </div>

    <div class="title">
        My Poker Face
    </div>

    <div class="container content">
        <div class="players">
            {% for player in players %}
                <div class="player-card">
                    <img src="{{ url_for('static', filename='images/kanye.jpg') }}"
                     class="player-headshot" alt="Player picture" >
                    <h2>{{ player.name }}</h2>
                    <p>${{ player.money }}</p>
                    <div id="{{ player.name }}-player-card" class="player-cards">
                        {% for card in player.cards %}
                            <span class="card
                                {% if card.suit == '♥' %}hearts{% elif card.suit == '♦' %}diamonds
                                {% elif card.suit == '♣' %}clubs{% elif card.suit == '♠' %}spades{% endif %}
                            ">{{ card.rank }}{{ card.suit }}</span>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="table-container content">
        <div class="table">
            <div class="pot">
                Pot: $1250 | Min: $50
            </div>
            <div class="community-cards">
                {% for card in community_cards %}
                    <span class="card
                        {% if card.suit == '♥' %}hearts{% elif card.suit == '♦' %}diamonds
                        {% elif card.suit == '♣' %}clubs{% elif card.suit == '♠' %}spades{% endif %}
                    ">{{ card.rank }}{{ card.suit }}</span>
                {% endfor %}
            </div>
            <div class="deck">
                [Deck]
            </div>
        </div>
    </div>

    <div class="player-options content">
        {% for option in player_options %}
            <button class="player-action" onclick="playerAction('{{ option }}')">{{ option }}</button>
        {% endfor %}
    </div>

    <div id="advantages-container" class="advantages collapsed">
        <div id="advantages-toggle-bar" class="messages-header">
            <h3>ADVANTAGES</h3>
        </div>
        <div class="nav-tabs">
            <div class="tabs active" id="tab-strategy">Strategy</div>
            <div class="tabs" id="tab-history">History</div>
            <div class="tabs" id="tab-actions">Actions</div>
            <div class="tabs" id="tab-inventory">Inventory</div>
        </div>

        <!-- Tab Content Sections -->
        <div class="tab-content active" id="content-strategy">
            <p>This is the strategy content.</p>
        </div>

        <div class="tab-content" id="content-history">
            <p>This is the history content.</p>
            <p>And this is more that we can see, we want to know what is happening?</p>
        </div>

        <div class="tab-content" id="content-actions">
            <p>This is the actions content.</p>
        </div>

        <div class="tab-content" id="content-inventory">
            <p>This is the inventory content.</p>
        </div>
    </div>

    <!-- Messages Window -->
    <div id="messages" class="messages collapsed">
        <div id="messages-toggle-bar" class="messages-header">
            <h3>MESSAGES</h3>
        </div>
        <div id="messages-display" class="messages-display">
            <p>Turn card is dealt: Qh</p>
            <p>Player 1's turn...</p>
            <!-- Additional messages... -->
        </div>
        <div>
            <label for="message-input"></label>
            <input type="text" id="message-input" placeholder="Send a message..." class="message-input">
            <button onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Background Image for the Bottom Portion -->
    <div class="background-bottom"></div>

    <script>
        document.getElementById('messages-toggle-bar').addEventListener('click', function() {
            let messages = document.getElementById('messages');
            messages.classList.toggle('collapsed');
        });

        document.getElementById('advantages-toggle-bar').addEventListener('click', function() {
            let advantages = document.getElementById('advantages-container');
            advantages.classList.toggle('collapsed');
        });

        // JavaScript to handle tab switching logic
        document.addEventListener("DOMContentLoaded", function() {
            const tabs = document.querySelectorAll(".tabs");
            const tabContents = document.querySelectorAll(".tab-content");
            const navTabs = document.querySelector(".nav-tabs");

            tabs.forEach(tab => {
                tab.addEventListener("click", function() {
                    const targetId = this.id.replace("tab-", "content-");

                    tabs.forEach(t => t.classList.remove("active"));
                    tabContents.forEach(tc => tc.classList.remove("active"));

                    this.classList.add("active");
                    document.getElementById(targetId).classList.add("active");

                    // Auto-scroll to the selected tab
                    tab.scrollIntoView({
                        behavior: 'smooth',
                        inline: 'center',
                        block: 'nearest'
                    });
                });
            });

            // Horizontal scrolling with mouse wheel
            navTabs.addEventListener("wheel", function(event) {
                if (event.deltaY !== 0) {
                    navTabs.scrollLeft += event.deltaY * 2;  // Adjust scroll speed if needed
                    event.preventDefault();  // Prevent vertical scrolling
                }
            });
        });

        // Fetch and display messages
        function fetchMessages() {
            fetch('/messages')
                .then(response => response.json())
                .then(data => {
                    let messagesDiv = document.getElementById('messages');
                    messagesDiv.innerHTML = '';
                    data.forEach(msg => {
                        let p = document.createElement('p');
                        p.textContent = msg;
                        messagesDiv.appendChild(p);
                    });
                });
        }

        // Send a new message
        function sendMessage() {
            let messageInput = document.getElementById('messageInput');
            let message = messageInput.value;

            fetch('/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    messageInput.value = '';
                    fetchMessages();
                } else {
                    alert('Error sending message');
                }
            });
        }

        // Initial message fetch
        fetchMessages();
    </script>
</body>
</html>