# T1-05: Raise Validation Bypass (RE-VERIFY)

## Finding
TRIAGE claimed `validate_and_sanitize()` is called but the sanitized amount is not enforced.

## Investigation

### Code Path Traced

**HTTP path** (`api_player_action`, `game_routes.py:982`):
1. `amount = data.get('amount', 0)` — raw from JSON request body
2. `play_turn(state_machine.game_state, action, amount)` — passed as-is
3. Inside `play_turn` (`poker_game.py:589`): dispatches to `player_raise(game_state, amount)`
4. Inside `player_raise` (`poker_game.py:470`): calls `context.validate_and_sanitize(raise_to_amount)` at line 490
5. `sanitized_amount` is used for all subsequent calculations (lines 500-504)

**Socket path** (`handle_player_action`, `game_routes.py:1217`):
1. `amount = int(data.get('amount', 0))` — cast to int, otherwise raw
2. `play_turn(state_machine.game_state, action, amount)` — passed as-is
3. Same `play_turn` → `player_raise` → `validate_and_sanitize` path

### Key Finding: Sanitized Amount IS Enforced

Inside `player_raise` (`poker_game.py:490-504`):
```python
sanitized_amount, correction_msg = context.validate_and_sanitize(raise_to_amount)
# ...
raise_by_amount = sanitized_amount - game_state.highest_bet
total_to_add = sanitized_amount - player.bet
game_state = place_bet(game_state=game_state, amount=total_to_add)
```

The `sanitized_amount` (not the raw input) is used for:
- Calculating `raise_by_amount` for min-raise tracking
- Calculating `total_to_add` for the actual bet
- All-in detection (line 496: `if sanitized_amount == player.stack + player.bet`)

### What `validate_and_sanitize` Does (`betting_context.py:59-94`)
- Caps amount at `max_raise_to` (stack limit)
- Adjusts below-minimum raises up to `min_raise_to`
- Handles all-in edge cases

## Verdict: **Dismissed — False Positive**

The original claim that "sanitized amount is not enforced" is incorrect. `validate_and_sanitize()` is called inside `player_raise()`, and its output (`sanitized_amount`) is what drives all subsequent bet logic.

**However**, there are real related gaps (covered by other tasks):
- **T1-17**: No early validation of the `action` string — invalid actions cause `AttributeError` via `getattr()` in `play_turn`
- **T1-18**: Socket handler lacks `is_human` check (HTTP handler has it at line 995)
- Neither handler validates the `action` is in `current_player_options` before calling `play_turn`

These are separate issues with their own task IDs and are not part of the T1-05 finding.
