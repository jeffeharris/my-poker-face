---
purpose: Flat generator architecture and emotional window mechanic for bounded option generation
type: design
created: 2026-02-12
last_updated: 2026-02-13
---

# Bounded Options Decision Framework

## Philosophy

LLMs can't play poker, but they can choose from a menu. The rule engine writes
a "choose your adventure" page for each decision point. The LLM picks an option
based on personality and narrative framing. Every option on the page should be
defensible — the kind of choice a real player might make.

Non-determinism is the goal. Absurdity is the enemy.

## Architecture

Options are generated by a **flat generator** that evaluates each action type
independently, then applies post-processing layers:

```
generate_bounded_options(context, profile, phase, in_range, ...)
  → CHECK generation (with check penalty + check promotion)
  → FOLD generation (with math blocking)
  → CALL generation (with math blocking)
  → RAISE generation (with postflop overrides, bluff gating)
  → Range biasing (out-of-range preflop hands)
  → Postflop raise limit
  → +EV promotion (profile-aware)
  → Truncation (2-4 options)
  → [controller] Composed nudges (optional, replaces rationale)
  → [controller] Emotional window shift (optional, slides option window)
  → [controller] Option order randomization (optional)
```

Math blocking is built into generation. No emotional state or play style can override it.

## Action Generation

### CHECK

Available when `cost_to_call = 0`. EV labeling depends on hand strength:

| Condition | EV | Style Tag | Rationale |
|-----------|-----|-----------|-----------|
| `equity >= value_bet_threshold` | marginal | trappy | "Strong hand — consider betting for value" |
| `equity >= check_penalty_threshold` | marginal | conservative | "You have betting equity — consider raising" |
| `equity >= 0.50` | neutral | conservative | "Check and see a free card" |
| Otherwise | neutral | conservative | "Check and see a free card" |

**Check promotion** (`profile.check_promotion`): Controls when check gets promoted to +EV.
- `default`: Promote best option to +EV (standard behavior)
- `always`: Always promote check with pot-control rationale
- `conditional`: Promote check only if no raise has neutral/+EV
- `suppress_if_raises`: Never promote check when raise options exist

**Check penalty** (`profile.check_penalty_threshold`): For aggressive profiles, marks check
as marginal when equity is above this threshold. Discourages passive play with betting hands.

### FOLD

Blocked (not generated) when:
- `equity > fold_equity_multiplier × required_equity` (profile-controlled)
- Monster hand (equity >= 90%)
- Pot-committed (already bet > remaining stack, equity >= 25%)

EV labeling from the player's perspective:
- `equity < required × 0.85` → +EV (folding saves money)
- `equity < required` → neutral
- `equity >= required` → -EV (folding gives up value)

**Range biasing**: When `in_range=False` and preflop, fold is labeled +EV with
range-specific rationale ("outside your ~25% range from BTN").

### CALL

Blocked when drawing dead (equity < 5%). Three-zone EV via profile thresholds:
- `equity >= required × call_plus_ev` → +EV
- `equity >= required × call_marginal` → marginal
- Below → -EV

### RAISE

Multiple sizes generated (small/medium/large) based on `profile.sizing_*` multipliers.
Postflop overrides available via `postflop_raise_plus_ev`, `postflop_raise_neutral`,
`postflop_value_bet_threshold`.

- Bluff raises gated on `profile.bluff_frequency > 0` (LAG profiles only)
- Honest rationale: -EV raises show "bluff bet" not "value bet"
- `postflop_max_raise_options` limits raise count postflop

### ALL-IN

Generated for strong hands when short-stacked, or as the maximum raise option.

## OptionProfile

Controls thresholds per play style. Key fields:

| Field | Default | Description |
|-------|---------|-------------|
| `fold_equity_multiplier` | 2.0 | Block fold when equity > N × required |
| `call_plus_ev` | 1.7 | Equity/required ratio for +EV call label |
| `call_marginal` | 0.85 | Equity/required ratio for marginal call label |
| `raise_plus_ev` | 0.60 | Absolute equity for +EV raise label |
| `raise_neutral` | 0.45 | Absolute equity for neutral raise label |
| `sizing_small/medium/large` | 0.33/0.67/1.0 | Pot multipliers for raise sizing |
| `value_bet_threshold` | 0.65 | Equity for "consider betting" on check |
| `bluff_frequency` | 0.0 | Probability of including -EV bluff raise |
| `postflop_raise_plus_ev` | None | Override for postflop (None = use preflop) |
| `postflop_raise_neutral` | None | Override for postflop |
| `postflop_value_bet_threshold` | None | Override for postflop |
| `postflop_max_raise_options` | None | Limit raise options postflop |
| `check_penalty_threshold` | None | Mark check as marginal above this equity |
| `check_promotion` | 'default' | Check promotion strategy |

### Style Presets

| Profile | Character | Key Differences |
|---------|-----------|-----------------|
| `tight_passive` | Rock | Higher fold/raise bars, smaller sizing, no bluffs |
| `tight_aggressive` | TAG | Raises with less equity, bigger sizing, no bluffs |
| `loose_passive` | Calling station | Calls more easily, wider marginal zone, no bluffs |
| `loose_aggressive` | LAG | Bets thinner, overbets, includes bluff raises |
| `default` | Balanced | Baseline thresholds |

## Emotional Window Shift

### Concept

Emotional states slide the option window along the passive↔aggressive spectrum.
The full spectrum of possible options for any decision:

```
← passive                                              aggressive →
FOLD — CHECK — CALL — RAISE(small) — RAISE(med) — RAISE(large) — ALL-IN
```

The generator + play style produce a window of options from this spectrum.
Emotional states shift that window.

### Probabilistic Application

Emotional impairment is not deterministic. A tilted player doesn't *always*
lose sight of the fold button — sometimes they take a breath and see clearly.

Each decision rolls against the severity to determine whether the emotional
window shift applies:

| Severity | Impaired (shifted window) | Lucid (normal options) |
|----------|--------------------------|----------------------|
| None | 0% | 100% |
| Mild | 70% | 30% |
| Moderate | 85% | 15% |
| Extreme | 95% | 5% |

When the roll comes up "lucid," the player gets their normal options with no
emotional modification. This creates natural variability — even an extremely
tilted player occasionally makes the right call.

### Severity Levels

When the emotional shift *does* apply:

| Severity | Effect |
|----------|--------|
| None | No modification. Base options from generator. |
| Mild | **Add** one option on the extreme end (expand the window). |
| Moderate | **Add** one option on the extreme end + narrative framing nudge. |
| Extreme | **Add** one option on the extreme end AND **remove** one from the opposite end (shift the window). |

### Emotional State Directions

| State | Direction | Mild | Moderate | Extreme |
|-------|-----------|------|----------|---------|
| **Tilted** | → aggressive | Add larger raise / ALL-IN | Add aggressive + narrative nudge | Add aggressive + remove FOLD or CHECK |
| **Overconfident** | → aggressive | Add larger value bet | Add overbet + narrative nudge | Add overbet + remove FOLD |
| **Shaken** | ← passive | Add FOLD or CHECK where normally absent | Add passive + narrative nudge | Add passive + remove largest RAISE |
| **Dissociated** | ← passive | Add CHECK | Strip rationale detail | Add passive + remove RAISE options |

### Interaction with Math Blocking

Math blocking always wins. The emotional window shift is applied *after*
initial generation, then math blocking is re-applied (`_reapply_math_blocking()`):

- Extreme tilt removes FOLD → but math blocking re-adds it if needed → safety net
- Extreme shaken removes CALL → but math blocking ensures at least one non-fold option
- No emotional state can create a menu where the only option is catastrophic

**Rule:** Math blocking cannot be overridden by emotional state.

### Narrative Framing

In addition to shifting the option window, emotional states modify the
rationale text on remaining options. This provides a secondary nudge:

| State | Narrative Effect |
|-------|-----------------|
| **Tilted** | Aggressive options framed as revenge/justice. Passive options framed as weakness. |
| **Overconfident** | Aggressive options framed as inevitability. Fold framed as inconceivable. |
| **Shaken** | Passive options framed as safety. Aggressive options framed with doubt. |
| **Dissociated** | Rationale stripped to bare minimum. Less information to reason with. |

Example rationale for the same RAISE option:

| State | Rationale |
|-------|-----------|
| Composed | "Value bet with strong hand" |
| Tilted | "They keep pushing you around. Push back." |
| Shaken | "Big bet... are you sure about this?" |
| Overconfident | "You're running hot. Press the advantage." |
| Dissociated | "Raise." |

## Composed Nudges

When `composed_nudges=True` on PromptConfig, raw EV labels and technical rationale
are replaced with playstyle-colored natural language phrases. Applied in the controller
*before* emotional shift (so emotional framing can override at moderate+).

Nudge categories are classified by `(action, ev_estimate, style_tag)`:

| Category | Source Actions |
|----------|---------------|
| `raise_value` | +EV raises |
| `raise_probe` | Neutral raises |
| `raise_bluff` | -EV/marginal aggressive raises |
| `call_strong` | +EV calls |
| `call_close` | Marginal calls |
| `call_light` | -EV/neutral calls |
| `check_slow` | Trappy checks |
| `check_passive` | -EV/marginal checks |
| `check_free` | Neutral/+EV checks |
| `fold_correct` | +EV/neutral folds |
| `fold_tough` | -EV folds |
| `all_in` | All-in actions |

Each profile has distinct phrase pools. The differential tone between action types
(e.g. "Make them pay" for raise vs "Easy call" for call) guides LLM selection
without explicit directives.

## Summary

The bounded options system is a choose-your-own-adventure book where:

1. **The flat generator** evaluates each action independently (check, fold, call, raise)
2. **OptionProfile** controls all thresholds, with postflop overrides and check promotion
3. **Range gate** biases out-of-range preflop hands toward folding
4. **Composed nudges** replace technical rationale with personality-colored phrases
5. **Emotional state** slides the option window and colors the narrative
6. **Math blocking** is the final safety net (never overridden)

The LLM never needs to understand poker. It just picks from a menu where
every option is defensible — or, when emotionally impaired, picks from a
menu that's been deliberately skewed.

## Key Files

| File | Role |
|------|------|
| `poker/bounded_options.py` | Flat generator, blocking logic, profiles, emotional shift |
| `poker/nudge_phrases.py` | Composed nudge phrases and classifier |
| `poker/hybrid_ai_controller.py` | Lean prompt assembly, hand plan, profile selection, nudge/shuffle wiring |
| `poker/prompt_config.py` | Feature flags (lean_bounded, composed_nudges, randomize_option_order, preflop_range_gate) |
| `config/game_modes.yaml` | Game mode presets |
